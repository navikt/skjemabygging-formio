name: Build and test
on:
  push
jobs:
  build-and-test:
    name: "Build and test packages"
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout"
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: "Bootstrap"
        run: yarn bootstrap
      - name: "Build"
        run: yarn build
      - name: "Test"
        run: yarn test
      - if: github.ref == 'refs/heads/master' # only create new release on the master branch
        name: "Create repository dispatch event [new-release]"
        uses: peter-evans/repository-dispatch@v1
        with:
          token: ${{ secrets.AKG_PAT }}
          event-type: new-release
          client-payload: '{"sha": "${{ github.sha }}"}'
