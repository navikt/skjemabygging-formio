---
apiVersion: nais.io/v1alpha1
kind: Application
metadata:
  name: {{app-name}}
  namespace: skjemadigitalisering
  labels:
    team: skjemadigitalisering
spec:
  image: {{image}}
  team: skjemadigitalisering
  port: 8080
  azure:
    application:
      enabled: true
      tenant: {{azure.application.tenant}}
  ingresses:
  {{#each ingresses as |url|}}
     - {{url}}
  {{/each}}
  liveness:
    path: /fyllut/internal/isAlive
    initialDelay: 10
  readiness:
    path: /fyllut/internal/isReady
    initialDelay: 10
  replicas:
    min: 2
    max: 4
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi
  prometheus:
    enabled: true  # default: false. Pod will now be scraped for metrics by Prometheus.
    path: /fyllut/internal/metrics # Path where prometheus metrics are served.
  accessPolicy:
    outbound:
      rules:
      {{#each accessPolicy.outbound.rules}}
        - application: {{this.application}}
          namespace: {{this.namespace}}
          cluster: {{this.cluster}}
      {{/each}}
      external:
        - host: {{dekorator-host}}
        - host: {{foersteside-host}}
        - host: {{skjemabygging-proxy-host}}
  env:
    - name: DECORATOR_URL
      value: {{dekorator-url}}
    - name: FOERSTESIDE_URL
      value: {{foersteside-url}}
    - name: FORMS_SOURCE
      value: {{forms-source}}
    - name: SKJEMABYGGING_PROXY_URL
      value: {{skjemabygging-proxy-url}}
    - name: SKJEMABYGGING_PROXY_CLIENT_ID
      value: {{skjemabygging-proxy-client-id}}
    {{#if enabled-features}}
    - name: ENABLED_FEATURES
      value: {{enabled-features}}
    {{/if}}
  envFrom:
  {{#each secrets as |secret|}}
    - secret: {{secret}}
  {{/each}}
